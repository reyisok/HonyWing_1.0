<Window x:Class="HonyWing.UI.Views.RegionSelectionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="区域选择"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        WindowState="Maximized"
        Cursor="Cross"
        KeyDown="OnKeyDown"
        MouseLeftButtonDown="OnMouseLeftButtonDown"
        MouseMove="OnMouseMove"
        MouseLeftButtonUp="OnMouseLeftButtonUp">
    
    <Window.Resources>
        <!-- 选择框样式 -->
        <Style x:Key="SelectionRectangleStyle" TargetType="Rectangle">
            <Setter Property="Stroke" Value="#FF0078D4"/>
            <Setter Property="StrokeThickness" Value="2"/>
            <Setter Property="Fill" Value="Transparent"/>
            <Setter Property="StrokeDashArray" Value="5,3"/>
        </Style>
        
        <!-- 信息面板样式 -->
        <Style x:Key="InfoPanelStyle" TargetType="Border">
            <Setter Property="Background" Value="#E6000000"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>
        
        <!-- 信息文本样式 -->
        <Style x:Key="InfoTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontFamily" Value="Consolas, Courier New"/>
        </Style>
        
        <!-- 帮助文本样式 -->
        <Style x:Key="HelpTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Direction="270" ShadowDepth="2" Opacity="0.8"/>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid>
        <!-- 半透明遮罩 -->
        <Rectangle x:Name="OverlayRectangle"
                   Fill="#80000000"
                   IsHitTestVisible="False"/>
        
        <!-- 选择区域 -->
        <Canvas x:Name="SelectionCanvas">
            <!-- 选择框 -->
            <Rectangle x:Name="SelectionRectangle"
                       Style="{StaticResource SelectionRectangleStyle}"
                       Visibility="Collapsed"/>
            
            <!-- 选择框角点 -->
            <Canvas x:Name="HandleCanvas" Visibility="Collapsed">
                <!-- 左上角 -->
                <Rectangle x:Name="TopLeftHandle"
                           Width="8" Height="8"
                           Fill="#FF0078D4"
                           Cursor="SizeNWSE"
                           MouseLeftButtonDown="OnHandleMouseDown"
                           MouseMove="OnHandleMouseMove"
                           MouseLeftButtonUp="OnHandleMouseUp"/>
                
                <!-- 右上角 -->
                <Rectangle x:Name="TopRightHandle"
                           Width="8" Height="8"
                           Fill="#FF0078D4"
                           Cursor="SizeNESW"
                           MouseLeftButtonDown="OnHandleMouseDown"
                           MouseMove="OnHandleMouseMove"
                           MouseLeftButtonUp="OnHandleMouseUp"/>
                
                <!-- 左下角 -->
                <Rectangle x:Name="BottomLeftHandle"
                           Width="8" Height="8"
                           Fill="#FF0078D4"
                           Cursor="SizeNESW"
                           MouseLeftButtonDown="OnHandleMouseDown"
                           MouseMove="OnHandleMouseMove"
                           MouseLeftButtonUp="OnHandleMouseUp"/>
                
                <!-- 右下角 -->
                <Rectangle x:Name="BottomRightHandle"
                           Width="8" Height="8"
                           Fill="#FF0078D4"
                           Cursor="SizeNWSE"
                           MouseLeftButtonDown="OnHandleMouseDown"
                           MouseMove="OnHandleMouseMove"
                           MouseLeftButtonUp="OnHandleMouseUp"/>
                
                <!-- 上边中点 -->
                <Rectangle x:Name="TopHandle"
                           Width="8" Height="8"
                           Fill="#FF0078D4"
                           Cursor="SizeNS"
                           MouseLeftButtonDown="OnHandleMouseDown"
                           MouseMove="OnHandleMouseMove"
                           MouseLeftButtonUp="OnHandleMouseUp"/>
                
                <!-- 下边中点 -->
                <Rectangle x:Name="BottomHandle"
                           Width="8" Height="8"
                           Fill="#FF0078D4"
                           Cursor="SizeNS"
                           MouseLeftButtonDown="OnHandleMouseDown"
                           MouseMove="OnHandleMouseMove"
                           MouseLeftButtonUp="OnHandleMouseUp"/>
                
                <!-- 左边中点 -->
                <Rectangle x:Name="LeftHandle"
                           Width="8" Height="8"
                           Fill="#FF0078D4"
                           Cursor="SizeWE"
                           MouseLeftButtonDown="OnHandleMouseDown"
                           MouseMove="OnHandleMouseMove"
                           MouseLeftButtonUp="OnHandleMouseUp"/>
                
                <!-- 右边中点 -->
                <Rectangle x:Name="RightHandle"
                           Width="8" Height="8"
                           Fill="#FF0078D4"
                           Cursor="SizeWE"
                           MouseLeftButtonDown="OnHandleMouseDown"
                           MouseMove="OnHandleMouseMove"
                           MouseLeftButtonUp="OnHandleMouseUp"/>
            </Canvas>
            
            <!-- 信息面板 -->
            <Border x:Name="InfoPanel"
                    Style="{StaticResource InfoPanelStyle}"
                    Visibility="Collapsed">
                <StackPanel>
                    <TextBlock x:Name="CoordinateText"
                               Style="{StaticResource InfoTextStyle}"/>
                    <TextBlock x:Name="SizeText"
                               Style="{StaticResource InfoTextStyle}"/>
                </StackPanel>
            </Border>
        </Canvas>
        
        <!-- 帮助信息 -->
        <StackPanel x:Name="HelpPanel"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
            <TextBlock Text="拖拽鼠标选择截图区域"
                       Style="{StaticResource HelpTextStyle}"/>
            <TextBlock Text="按 Enter 确认选择，按 Esc 取消"
                       Style="{StaticResource HelpTextStyle}"
                       Margin="0,10,0,0"/>
        </StackPanel>
        
        <!-- 工具栏 -->
        <Border x:Name="ToolbarPanel"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="20"
                Style="{StaticResource InfoPanelStyle}"
                Visibility="Collapsed">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="ConfirmButton"
                        Content="✓ 确认"
                        Background="#FF0078D4"
                        Foreground="White"
                        BorderThickness="0"
                        Padding="10,5"
                        Margin="0,0,5,0"
                        Click="OnConfirmClick"
                        ToolTip="确认选择 (Enter)"/>
                
                <Button x:Name="CancelButton"
                        Content="✗ 取消"
                        Background="#FF6B6B6B"
                        Foreground="White"
                        BorderThickness="0"
                        Padding="10,5"
                        Click="OnCancelClick"
                        ToolTip="取消选择 (Esc)"/>
            </StackPanel>
        </Border>
        
        <!-- 十字准线 -->
        <Canvas x:Name="CrosshairCanvas" IsHitTestVisible="False">
            <!-- 垂直线 -->
            <Line x:Name="VerticalCrosshair"
                  Stroke="#80FFFFFF"
                  StrokeThickness="1"
                  Y1="0"
                  Y2="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Window}}"
                  Visibility="Collapsed"/>
            
            <!-- 水平线 -->
            <Line x:Name="HorizontalCrosshair"
                  Stroke="#80FFFFFF"
                  StrokeThickness="1"
                  X1="0"
                  X2="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}}"
                  Visibility="Collapsed"/>
        </Canvas>
    </Grid>
</Window>